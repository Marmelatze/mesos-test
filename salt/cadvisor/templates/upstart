description "cadvsior"

start on filesystem and started docker
stop on runlevel [!2345]

respawn
respawn limit 10 10

start on started docker
stop on stopped docker

pre-start script
  /usr/bin/docker rm -f cadvisor ||true
end script

script
docker run \
  --volume=/:/rootfs:ro \
  --volume=/var/run:/var/run:rw \
  --volume=/sys:/sys:ro \
  --volume=/var/lib/docker/:/var/lib/docker:ro \
  --name=cadvisor \
  -p 4040:8080 \
  google/cadvisor:latest -storage_driver=influxdb -storage_driver_host={{ pillar['docker']['gw'] }}:8086
end script
